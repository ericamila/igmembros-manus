{% extends "core/base.html" %}
{% load humanize %}

{% block title %}Detalhes da Prestação: {{ report.month|stringformat:"02d" }}/{{ report.year }}{% endblock %}
{% block page_title %}Detalhes da Prestação: {{ report.month|stringformat:"02d" }}/{{ report.year }}{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="mb-6 pb-4 border-b">
        <h3 class="text-lg font-medium text-gray-900 mb-2">Informações Gerais</h3>
        <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 text-sm">
            <div class="col-span-1">
                <dt class="text-gray-500">Mês/Ano:</dt>
                <dd class="text-gray-900 font-medium">{{ report.month|stringformat:"02d" }}/{{ report.year }}</dd>
            </div>
            <div class="col-span-1">
                <dt class="text-gray-500">Valor Total:</dt>
                <dd class="text-gray-900 font-medium">R$ {{ report.amount|intcomma }}</dd>
            </div>
            <div class="col-span-1">
                <dt class="text-gray-500">Criado em:</dt>
                <dd class="text-gray-900">{{ report.created_at|date:"d/m/Y H:i" }}</dd>
            </div>
            <div class="col-span-1">
                <dt class="text-gray-500">Atualizado em:</dt>
                <dd class="text-gray-900">{{ report.updated_at|date:"d/m/Y H:i" }}</dd>
            </div>
        </dl>
    </div>

    <div>
        <h3 class="text-lg font-medium text-gray-900 mb-4">Documentos Anexados ({{ documents.count }})</h3>
        {% if documents %}
        <ul class="divide-y divide-gray-200 border rounded-md">
            {% for doc in documents %}
            <li class="px-4 py-3 flex items-center justify-between hover:bg-gray-50">
                <div class="flex items-center space-x-3">
                    {% comment %} Icon based on file type {% endcomment %}
                    {% with doc.document.name|lower as doc_name %}
                    <span class="inline-flex items-center justify-center h-8 w-8 rounded-full 
                        {% if ".pdf" in doc_name %}bg-red-100 text-red-600
                        {% elif ".xls" in doc_name or ".xlsx" in doc_name %}bg-green-100 text-green-600
                        {% elif ".jpg" in doc_name or ".jpeg" in doc_name or ".png" in doc_name or ".gif" in doc_name %}bg-blue-100 text-blue-600
                        {% else %}bg-gray-100 text-gray-600{% endif %}">
                        {% if ".pdf" in doc_name %}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
                        {% elif ".xls" in doc_name or ".xlsx" in doc_name %}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" /><path d="M10 9a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1zm-2 2a1 1 0 011-1h4a1 1 0 110 2h-4a1 1 0 01-1-1z" /></svg>
                        {% elif ".jpg" in doc_name or ".jpeg" in doc_name or ".png" in doc_name or ".gif" in doc_name %}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" /></svg>
                        {% else %}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd" /></svg>
                        {% endif %}
                    </span>
                    {% endwith %}
                    <div class="text-sm">
                        <a href="{{ doc.document.url }}" target="_blank" class="font-medium text-blue-600 hover:text-blue-800 hover:underline">{{ doc.document.name|cut:"accountability_documents/" }}</a>
                        {% if doc.description %}
                            <p class="text-gray-500">{{ doc.description }}</p>
                        {% endif %}
                    </div>
                </div>
                <span class="text-xs text-gray-500">{{ doc.uploaded_at|date:"d/m/Y H:i" }}</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="text-center py-4 text-gray-500">
            Nenhum documento anexado a esta prestação de contas.
        </div>
        {% endif %}
    </div>

    <div class="mt-6 flex justify-end space-x-3 border-t pt-4">
        <a href="{% url 'reports:accountability_list' %}" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded">Voltar à Lista</a>
        <a href="{% url 'reports:accountability_update' report.pk %}" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded">Editar</a>
        <a href="{% url 'reports:accountability_delete' report.pk %}" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">Excluir</a>
    </div>
</div>
{% endblock %}

