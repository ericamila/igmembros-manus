{% extends "core/base.html" %}
{% load my_filters %}
{% load static %}
{% load humanize %}

{% block title %}Relatório Balanço Patrimonial (Simplificado){% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <h1 class="mt-4">Relatório Balanço Patrimonial (Simplificado)</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="{% url 'dashboard:index' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'reports:index' %}">Relatórios</a></li>
        <li class="breadcrumb-item active">Balanço</li>
    </ol>

    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-filter me-1"></i>
            Filtros
        </div>
        <div class="card-body">
            <form method="get">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="end_date" class="form-label">Data Final:</label>
                        <input type="date" name="end_date" id="end_date" class="form-control" value="{{ end_date_str }}">
                    </div>
                    <div class="col-md-4 d-flex align-items-end mb-3">
                        <button type="submit" class="btn btn-primary">Filtrar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-balance-scale me-1"></i>
            Balanço Patrimonial em {{ end_date|date:"d/m/Y" }}
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5>Ativos</h5>
                    <table class="table table-bordered" width="100%" cellspacing="0">
                        <tbody>
                            {% for name, value in assets.items %}
                            <tr>
                                <td>{{ name }}</td>
                                <td class="text-end">{{ value|intcomma }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr class="table-light">
                                <th>Total Ativos</th>
                                <th class="text-end">{{ total_assets|intcomma }}</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <div class="col-md-6">
                    <h5>Passivos e Patrimônio Líquido</h5>
                    <table class="table table-bordered" width="100%" cellspacing="0">
                        <tbody>
                             {% for name, value in liabilities_equity.items %}
                            <tr>
                                <td>{{ name }}</td>
                                <td class="text-end">{{ value|intcomma }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr class="table-light">
                                <th>Total Passivos + PL</th>
                                <th class="text-end">{{ total_liabilities_equity|intcomma }}</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
             <div class="row mt-3">
                <div class="col text-center">
                    {% if total_assets == total_liabilities_equity %}
                        <span class="text-success"><i class="fas fa-check-circle"></i> Balanço confere.</span>
                    {% else %}
                        <span class="text-danger"><i class="fas fa-exclamation-triangle"></i> Balanço não confere. Diferença: {{ total_assets|sub:total_liabilities_equity|intcomma }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

