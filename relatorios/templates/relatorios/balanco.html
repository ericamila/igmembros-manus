{% extends 'core/base.html' %}
{% load humanize %}

{% block title %}Balanço Patrimonial Simplificado{% endblock %}
{% block page_title %}Balanço Patrimonial Simplificado (até {{ data_fim|date:"d/m/Y" }}){% endblock %}

{% block content %}

<!-- Filtro de Data -->
<div class="bg-white rounded-lg shadow-md p-4 mb-6">
    <form method="get" action="{% url 'relatorios:balanco' %}" class="flex items-end space-x-4">
        <div>
            <label for="data_fim" class="block text-sm font-medium text-gray-700">Data Final:</label>
            <input type="date" name="data_fim" id="data_fim" value="{{ data_fim_str }}" class="mt-1 block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm rounded-md">
        </div>
        <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
            Filtrar
        </button>
    </form>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Ativos -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Ativos</h2>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Conta</th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for conta, valor in ativos.items %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ conta }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 text-right">R$ {{ valor|intcomma }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">Nenhum ativo calculado.</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="bg-gray-50">
                    <tr>
                        <th scope="row" class="px-6 py-3 text-right text-sm font-medium text-gray-900 uppercase tracking-wider">Total Ativos</th>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700 font-bold text-right">R$ {{ total_ativos|intcomma }}</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- Passivos e Patrimônio Líquido -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Passivos e Patrimônio Líquido</h2>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Conta</th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for conta, valor in passivos_patrimonio.items %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ conta }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 text-right">R$ {{ valor|intcomma }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">Nenhum passivo ou patrimônio líquido calculado.</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="bg-gray-50">
                    <tr>
                        <th scope="row" class="px-6 py-3 text-right text-sm font-medium text-gray-900 uppercase tracking-wider">Total Passivo + PL</th>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700 font-bold text-right">R$ {{ total_passivos_patrimonio|intcomma }}</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>

{% if total_ativos != total_passivos_patrimonio %}
<div class="mt-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
    <strong>Atenção:</strong> O total de Ativos (R$ {{ total_ativos|intcomma }}) não bate com o total de Passivos + Patrimônio Líquido (R$ {{ total_passivos_patrimonio|intcomma }}). Este é um balanço simplificado baseado apenas no saldo acumulado.
</div>
{% endif %}

{% endblock %}

