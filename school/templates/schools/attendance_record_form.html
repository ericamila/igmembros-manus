{% extends 'core/base.html' %}

{% block title %}Registrar Frequência - {{ school_class.name }} - {{ block.super }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Registrar Frequência para {{ school_class.name }}</h1>

    <form method="post" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
        {% csrf_token %}
        {{ form.school_class_pk }} {# Hidden field #}

        <div class="mb-6">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="{{ form.date.id_for_label }}">
                {{ form.date.label }}
            </label>
            {{ form.date }}
            {% if form.date.errors %}
                <p class="text-red-500 text-xs italic">{{ form.date.errors|striptags }}</p>
            {% endif %}
            <p class="text-gray-600 text-xs italic mt-1">Selecione a data para registrar ou visualizar a frequência.</p>
            <button type="button" onclick="reloadWithDate()" class="mt-2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-1 px-3 rounded text-sm focus:outline-none focus:shadow-outline">
                Carregar Frequência da Data
            </button>
        </div>

        <h2 class="text-xl font-semibold text-gray-700 mb-4">Alunos</h2>
        {% if students %}
        <div class="overflow-x-auto">
            <table class="min-w-full leading-normal">
                <thead>
                    <tr>
                        <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Aluno
                        </th>
                        <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Presente
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr>
                        <td class="px-5 py-4 border-b border-gray-200 bg-white text-sm">
                            {{ student.member.name }}
                        </td>
                        <td class="px-5 py-4 border-b border-gray-200 bg-white text-sm text-center">
                            <input type="checkbox" name="present_students" value="{{ student.pk }}" 
                                   class="form-checkbox h-5 w-5 text-blue-600" 
                                   {% if student.pk in existing_attendance %}checked{% endif %}>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-gray-500">Nenhum aluno matriculado nesta turma.</p>
        {% endif %}

        <div class="flex items-center justify-between mt-8">
            <a href="{% url 'school:school_class_detail' school_class.pk %}" class="text-gray-600 hover:text-gray-800 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                Cancelar
            </a>
            <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
                Salvar Frequência
            </button>
        </div>
    </form>
</div>

{% block extra_js %}
<script>
function reloadWithDate() {
    const dateField = document.getElementById('{{ form.date.id_for_label }}');
    const selectedDate = dateField.value;
    if (selectedDate) {
        // Construct the URL with the date parameter
        const currentUrl = window.location.pathname; // Gets the path part, e.g., /school/turma/1/frequencia/
        window.location.href = currentUrl + '?date=' + selectedDate;
    } else {
        alert('Por favor, selecione uma data.');
    }
}
</script>
{% endblock %}

{% endblock %}

